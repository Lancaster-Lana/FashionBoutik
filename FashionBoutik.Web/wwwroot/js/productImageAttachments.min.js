if(typeof jQuery=="undefined")throw new Error("jQuery plugins need to be before this file");(function(n){n.product={};n.product.imageAttachments={init:function(){n.product.imageAttachments.initUploadAttachmentPlugin();n.product.imageAttachments.initUploadAttachment();n.product.imageAttachments.initDeleteAttachment();var t=n("#productId").val();n.product.imageAttachments.refreshAttachmentsList(t)},initDeleteAttachment:function(){var t=n(".delete-productAttachedFile");t.unbind("click");t.on("click",function(){var t=n(this),i=n("#productId").val(),r=t.attr("data-id"),u=t.attr("data-value");return swal({title:"Are you sure you want to proceed?",text:'"'+u+'" will be deleted',icon:"warning",buttons:["No, cancel it!","Yes, I am sure!"],dangerMode:!0,showCancelButton:!0,closeOnConfirm:!0}).then(function(){isConfirmed&&n.ajax({type:"post",contentType:!1,processData:!1,url:"/Admin/Product/DeleteAttachedFile?productId="+i+"&fileId="+r,success:function(){n.product.imageAttachments.refreshAttachmentsList(i)},error:function(){swal("An error occurred deleting file. If you continue to see this issue, please contact your system administrator.","Error deleting attached file!","error")}}).done(function(){})}),!1})},initUploadAttachmentPlugin:function(){function r(t,i){console.log("File Start!");n(this).parents("form").find(".filelist.queue").find("li[data-index="+i.index+"]").find(".progress").text("0%")}function u(t,i,r){console.log("File Error:"+r);n(this).parents("form").find(".filelist.queue").find("li[data-index="+i.index+"]").addClass("error").find(".progress").text("Error: "+r)}function f(t,i,r){var u=n(this).parents("form").find(".filelist.queue").find("li[data-index="+i.index+"]");u.find(".progress").text(r+"%");u.find(".bar").css("width",r+"%")}function e(t,i,r){var e=n("#productId").val(),f,u;n.product.imageAttachments.refreshAttachmentsList(e);f=JSON.parse(r);r.trim()===""||f.error!==null?n(this).parents("form").find(".filelist.queue").find("li[data-index="+i.index+"]").addClass("error").find(".progress").text(r.trim()):(u=n(this).parents("form").find(".filelist.queue").find("li[data-index="+i.index+"]"),u.find(".file").text(i.name),u.find(".progress").remove(),u.find(".cancel").remove(),u.appendTo(n(this).parents("form").find(".filelist.complete")))}function o(){console.log("Start");n(this).parents("form").find(".filelist.queue").find("li").find(".progress").text("Waiting")}function s(t,i){var u,r;for(console.log("Queued"),u="",r=0;r<i.length;r++)u+='<li data-index="'+i[r].index+'"><span class="content"><span class="file">'+i[r].name+'<\/span><span class="cancel">Cancel<\/span><span class="progress">Queued<\/span><\/span><span class="bar"><\/span><\/li>';n(this).parents("form").find(".filelist.queue").append(u)}function h(){console.log("Uploaded!")}function c(){console.log("Cancel");var t=n(this).parents("li").data("index");n(this).parents("form").find(".upload").upload("abort",parseInt(t,10))}function l(){console.log("Cancel All");n(this).parents("form").find(".upload").upload("abort")}var t=0,i;n("#productId")&&(t=n("#productId").val());i="/Admin/Product/UploadAttachedFiles?productId="+t;n(".upload").unbind("upload");n(".upload").upload({action:i,maxSize:107374182400,accept:".gif,.png,.jpg,.jpeg"}).on("start.upload",o).on("filestart.upload",r).on("fileprogress.upload",f).on("filecomplete.upload",e).on("fileerror.upload",u).on("complete.upload",h).on("queued.upload",s);n(".filelist.queue").on("click",".cancel",c);n(".cancel_all").on("click",l)},initUploadAttachment:function(){var t=n(".upload-productAttachedFile");t.on("click",function(){var f=n("[name=spf-files]").get(0),r=0,t,u,i;if(n("#productId")&&(r=n("#productId").val()),t=f.files,t.length===0)return swal("Please select a file, then click Upload","You have not selected a file","error"),!1;for(u=new FormData,i=0;i<t.length;i++)u.append(t[i].name,t[i]);return n.ajax({type:"post",url:"/Admin/Product/UploadAttachedFiles?productId="+r,contentType:!1,processData:!1,data:u,success:function(){n("[name=spf-files]").val("");n.product.imageAttachments.refreshAttachmentsList(r)},error:function(){swal("An error occurred uploading your file. If you continue to see this issue, please contact your system administrator.","Error uploading file!","error")}}).done(function(){}),!1})},refreshAttachmentsList:function(t){var r=n("#attachmentsList"),i;t&&t>0&&(i="/Admin/Product/AttachmentsList?productId="+t,n(r).load(i,function(t,i){if(i==="success"){n.product.imageAttachments.initDeleteAttachment();var r=n("#attachmentsList ul[name='uploadedFiles'] > li").length;n("label#attachmentsCount").each(function(){n(this).text(r)})}}))}}})(jQuery),function(){$(function(){$.product.imageAttachments.init()})}();